<h1 class="title toc-ignore">fbwR Shiny: How to use this app</h1>
<h4 class="date">2024-12-20</h4>

<h2 class="title toc-ignore">What is the fbwR model?</h2>
<p><code>fbwR</code> is an R-based version of the <strong>Fish Benefits
Workbook</strong>, a modelling approach to integrating hydrology and
fish behavior to predict the passage efficiency and survival of fish as
they pass downstream of dams. It considers the movement of fish as they
pass from the forebay of a dam to its tailrace, accounting for which
routes fish can take through the dam at time of passage, and the
relative survival of passage through those routes.</p>
<p>To simulate downstream passage of fish, especially fish that migrate
with the flow of water during seaward migration, it is useful to build a
model that incorporates two things:</p>
<ol style="list-style-type: decimal">
<li><strong>Hydrology</strong>: the position and velocity of water
passing through a dam.</li>
<li><strong>Responses to hydrology</strong>: how hydrological influences
will impact where and how well fish can approach, enter, and
successfully pass the dam.</li>
</ol>
<p><code>fbwR</code> combines these in a way that allows for modellers
and decision makers to assess changes to dam operations (including, for
example, the distribution of flow through a dam, timing of flow
operations, and reservoir elevation) and changes to dam structures
(including the building of fish passage structures).</p>
<div id="data-requirements" class="section level2">
<h3>Using the R Shiny Application</h3>
<p>fbwR requires two types of inputs: hydrological conditions at the dams, and parameters describing how fish respond to hydrology.</p>
<div id="step1-ressim" class="section level2"></div>
<h4>Step 1: Upload results of a ResSim hydrological simulation model</h4>
<p>The first step is to upload HEC-ResSim files (in the form of .xlsx or .xlsm) to the app. Looking at the top panel of the application, click on the "Hydrology inputs" tab.</p>
<p>There, you will see three panels: a light blue panel including helptext, and two dark blue panels where you specify how to read in the ResSim file. Click the light blue helptext box on this tab for full details on the required data format for ResSim simulation model results and how to upload the required data.</p> 
<p>After uploading the files, the app will ask you to verify which sheets in the workbook contain the required types of hydrological information (e.g., which sheet includes pool elevation, which one includes total outflow, etc.). Clicking on the "Next (compiles ResSim)" button takes you to a preview page, where you can see the uploaded and compiled ResSim hydrological variables for each day in the period of record.</p>
</div>
<div id="step2-biological" class="section level2"></div>
<h4>Step 2: Upload fish passage and dam operation parameters</h4>
<p>After uploading hydrological information, you can then upload details of dam operation and fish responses to hydrology.</p>
<p>Click on the tab labelled "Fish passage parameters" to see the four steps of this process: </p>
<ol style="list-style-type: decimal">
  <li><strong>Upload parameters from a template</strong>: On this tab, you can upload a pre-filled parameter template and download your input parameters as an Excel file that matches the template format. You can also download a blank template to save to your computer and fill in manually outside of the Shiny app.<br><i>If you do not have a parameter template, or want to adjust the parameters you entered, go on to fill in the parameters in three steps:<br></i></li>
  <li><strong>Step 1. Dam passage/outlet settings</strong>: Here, enter parameters about how the dam is operated. This includes which dam outlets to simulate, whether a fish passage structure should be simulated, the operational limits of those outlets (e.g., pool elevations where they can pass flow), and outlet attractiveness.<br></li>
  <li><strong>Step 2. Monthly run timing and dam passage efficiency</strong>: Here, enter tabular data about run timing (both baseline and alternative; alternative run timing is used when a fish passage structure is in place) and dam passage efficiency (DPE) at different elevations and when different fish passage structures are in place.<br></li>
  <li><strong>Step 3. Passage survival</strong>: Enter survival parameters for each outlet. First, enter either a fixed survival rate or input survival as a function of flow. If a function of flow, a table will appear that you can fill in with survival parameters across different flow rates through the outlet. **Note:** the flow rate used to calculate survival may reflect multi-gate operations; parameters you enter in the "Dam passage/outlet settings" step will dictate whether flow is distributed between multiple gates for a given outlet.<br></li>
</ol> 
<h4>Step 3: Run the FBW model and view/download graphical and tabular simulation results</h4>
<p>In the final step of the Shiny app, after inputting all of the required hydrological and biological parameters, you can run the passage simulation. There may be warnings at the top of this page - if so, reading the warning should help you identify which parameters may have been specified incorrectly or missing.</p>
<p>Assuming there are no errors, when you click the "Run fbwR" button, after a moment results will appear. Both summarized and unsummarized results are available to view and download in tabular format (summarized results are compiled into averages by month and by water year type, raw results are reported on a daily timestep within the period of record).</p>
<p>Monthly summaries of the distribution of flow and fish (as well as passage survival) are shown in Sankey plots. These plots are interactive and you may hover over them to see monthly averaged flow, fish passage and survival rates through the dam outlets.</p>